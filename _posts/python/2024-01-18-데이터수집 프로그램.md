---
title: 데이터수집 프로그램
author: gt.kim
date: 2024-01-18 16:52:00
categories: [python]
tags: [python]
image:
  path: https://news.kbs.co.kr/data/news-tmp/2021/04/23/20210423_os5Qwd.png
  hide: true
  alt: 찰리 채플린의 영화 《모던 타임즈》(1936)의 한 장면
comments: true
---
> _기계처럼 반복되는 업무를 프로그램화할 수 있는 것이야말로 개발자의 축복아닐까?_

![찰리 채플린의 영화 《모던 타임즈》(1936)의 한 장면](https://news.kbs.co.kr/data/news-tmp/2021/04/23/20210423_os5Qwd.png)
_찰리 채플린의 영화 《모던 타임즈》(1936)의 한 장면_


## 발단

친구녀석은 전기업체를 다닌다. 해당 업체는 많은 사업을 수주하기 위해 나라장터[^footnote1]에서 과거 수주내역을 분석하여 나름의 패턴(?)을 발견하였다! ~~(예정가격사정률[^footnote2]이라는 정보를 활용하더라.. 자세한 건 비밀🤫)~~

하지만 이를 체계적으로 관리할 시스템이 없어서 소수점 아래 5자리까지의 큰 수를 노트에 수기로 일일히 적어서 관리하고 있더라.

> 넌 개발자니까 개선할 수 있잖아? (나를 자극해? 코딩으로 혼내주지ㅎㅎ) 
{: .prompt-warning }

## 전개

### 1. 카카오톡으로 간간히 소통

나도 일을 하고 있으니..(먹고는 살아야지ㅠㅠ) 카카오톡으로 뜨문뜨문 소통했는데 Needs를 파악하기 너무 힘들어서 날을 잡고 Teams 회의를 진행했다.

### 2. Teams 회의

![개발자 유머 - 그네](https://velog.velcdn.com/images%2Fwind1992%2Fpost%2F448d848b-3f44-4a73-8d5c-b3f57d4387ce%2Fimage.png)
_개발자 유머 - 그네_

아무래도 개발이 뭔지 생판모르는 완전한 비개발자와 소통하다보니 
우리가 서로 같은 내용을 말하고 있는가에 대한 걱정이 많았다.

혹여나, 당연하지만 빠진 요구사항이 있는지, 불편사항, 필요한 사항이 뭔지 계속 꼬치꼬치 캐물어 요구사항을 상세화하였다.

### 3. 회의 결과 
  - 데이터 수집이 필요했고, 
  - 수집한 데이터 중 필요한 데이터를 발라내어
  - 필요에 맞는 계산을 하여 정보로써 추출.
  - 추출한 정보를 표출하고 저장하는 로직이 필요했다.

> 결과적으로 데이터 수집 및 분석에 용이한 python을 활용해 개발해보기로 했다. (필승! Yes I can)
{: .prompt-info }


## 위기






3. 빠른 배포 프로토타입 v1.0

### 프로세스 정립

![process flowchart](/assets/img/python/process.JPG)
_process flowchart_

#### 1. GUI 실행

GUI 구성을 위한 파이썬 기본 패키지인 Tkinter를 커스텀한 `customtkinter`를 활용해봤다! (Tkinter는 먼가 그래픽이 올드한 기억이 있어서..)

![python program GUI](/assets/img/python/gui.JPG)
_python program GUI_

```python
  def __init__(self):
    super().__init__()

    customtkinter.set_default_color_theme("blue")
    customtkinter.set_appearance_mode("dark")

    self.title("🍀Good Luck")
    self.geometry("400x450")
    self.resizable(width=True, height=False)
    self.grid_columnconfigure((0, 1), weight=1)
    self.grid_rowconfigure((6), weight=1)

    #Login Info.
    self.login_frame = MyLoginFrame(self, "로그인 정보")
    self.login_frame.grid(row=0, column=0, padx=10, pady=(10, 0), sticky="nsew")

    #Search Info.
    self.parameter_frame = MyParameterFrame(self, "검색 조건")
    self.parameter_frame.grid(row=0, column=1, padx=10, pady=(10, 0), sticky="nsew")

    #Execute Button
    self.button = customtkinter.CTkButton(self, text=INIT_BUTTON_TEXT, command=self.execute)
    self.button.grid(row=4, column=0, padx=5, pady=5, sticky="ew", columnspan=3)

    #Logging Textbox
    self.textbox = customtkinter.CTkTextbox(self, width=400, corner_radius=0)
    self.textbox.configure(state="disabled")
    self.textbox.tag_config("ERROR", foreground="red")
    self.textbox.tag_config("WARN", foreground="yellow")
    self.textbox.grid(row=5, column=0, padx=5, pady=5, sticky="nsew", columnspan=3)

    #Company + Version Info.
    self.label = customtkinter.CTkLabel(
        self, text=f"{COMPANY_NAME} {VERSION}", anchor="e"
    )
    self.label.grid(row=6, column=0, padx=5, pady=5, sticky="nsew", columnspan=3)
```


#### 2. 세션을 통해 조회조건에 맞는 데이터 목록 수집

로그인이 필요한 사이트로부터 데이터를 가져와야 했기에 세션정보를 활용할 수 있는 `requests` 모듈을 이용했고, 받아온 html을 파싱하기 위해 `beautifulsoup4`을 썼다. (python이 확실히 간편해서 좋드라~)

 ```python
import requests

from bs4 import BeautifulSoup

...전략...

  session = requests.session()
        
  url = ""  #service URL
  data = {
      "id": self.app.getParameter("id"), #아이디
      "pw": self.app.getParameter("pw"), #패스워드
  }

  response = session.post(url, data)
  soup = BeautifulSoup(response.text, "html.parser")

...후략...
```

#### 3. 수집한 데이터 목록 중 필요한 데이터만 추출 및 정제




#### 4. 읽은 데이터를 공식을 통해 분석 및 가공


#### 5. 가공된 정보 표출 및 저장


### python 라이브러리 목록

#### 데이터 수집
 - `requests`
 - `beautifulsoup4`

#### 데이터 정제 및 분석
 - `pyarrow`
 - `parquet`
 - `pandas`
 - `seaborn`

#### GUI
 - `customtkinter`
 - `pyinstaller`




## 절정

### windows 8 + excel 2007
![RIP windows 8](https://www.ajr-computing.co.uk/wp-content/uploads/2016/01/Microsoft-Windows-8-Support-Ended-On-Jan-12th-2016.gif)
_RIP windows 8_


> 아직도 windows 8에 excel 2007을 쓰고 있다고..!?😱😱😱😱🤪
{: .prompt-danger }

고대유물을 쓰고 있는 내 친구. ~~(혹시 박물관에서 일하는 지 물어보고 싶었다.)~~

속도와 시스템 사용성(메모리 등)을 고민하였다.

encoding이 다른 문제. (ANSI <-> UTF-8)
TBD

### 데이터가 없는 경우

TBD

4. 사용성 개선 + 버그 개선

## 결말



## Footnote
[^footnote1]: 국가종합전자조달, 조달청 운영 공공기관 물자구매, 시설공사 계약 입찰 통합시스템. <https://www.g2b.go.kr/>
[^footnote2]: 사정률은 예정 가격을 기초금액으로 나눈 비율 로,기초 금액을 100으로 기준했을 때 복수예비가격 범위 내 예정가격의 위치를 말합니다. 따라서 사정률 분석은 예정가격의 위치를 예측하는 것이라고 볼 수 있습니다.